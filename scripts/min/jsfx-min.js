!function(e){"use strict";function t(e,t){return e.stage-t.stage}function a(e,t){for(var a=0;a<t.length;a+=1){var r=t[a],n=e[r.name]||{};S(r.params,function(e,t){"undefined"==typeof n[t]&&(n[t]=e.D)}),e[r.name]=n}}function r(r,n){r=r||{},n=n||e.DefaultModules,r="function"==typeof r?r():JSON.parse(JSON.stringify(r)),this.finished=!1,this.state={SampleRate:r.SampleRate||e.SampleRate},n=n.slice(),n.sort(t),this.modules=n,a(r,n);for(var o=0;o<this.modules.length;o+=1){var i=this.modules[o];this.modules[o].setup(this.state,r[i.name])}}function n(){return S(e.Module,function(){return{}})}function o(e){for(var t in e)0==v(e[t]).length&&delete e[t]}function i(e){return new Function("$","block","var TAU = Math.PI * 2;\nvar sample;\nvar phase = +$.generatorPhase,\n	A = +$.generatorA, ASlide = +$.generatorASlide,\n	B = +$.generatorB, BSlide = +$.generatorBSlide;\n\nfor(var i = 0; i < block.length; i++){\n	var phaseSpeed = block[i];\n	phase += phaseSpeed;\n	if(phase > TAU){ phase -= TAU };\n	A += ASlide; B += BSlide;\n   A = A < 0 ? 0 : A > 1 ? 1 : A;\n   B = B < 0 ? 0 : B > 1 ? 1 : B;\n"+e+"	block[i] = sample;\n}\n\n$.generatorPhase = phase;\n$.generatorA = A;\n$.generatorB = B;\nreturn block.length;\n")}function u(t){function a(e){for(var t=0;t<e.length;t+=1)i[u]=e.charCodeAt(t),u++}function r(e,t){0>=t||(i[u]=255&e,u++,r(e>>8,t-1))}"undefined"!=typeof Float32Array&&d(t instanceof Float32Array,"data must be an Float32Array");var n=F*A>>3,o=e.SampleRate*n,i=y(44+2*t.length),u=0;return a("RIFF"),r(36+2*t.length,4),a("WAVEfmt "),r(16,4),r(1,2),r(F,2),r(e.SampleRate,4),r(o,4),r(n,2),r(A,2),a("data"),r(2*t.length,4),l(i.subarray(u),t),i}function s(e){var t=u(e);return new Audio("data:audio/wav;base64,"+p(t))}function l(e,t){d(e.length/2==t.length,"the target buffer must be twice as large as the iinput");for(var a=0,r=0;r<t.length;r++){var n=+t[r],o=32767*n|0;o=-32768>o?-32768:o>32767?32767:o,o+=0>o?65536:0,e[a]=255&o,a++,e[a]=o>>8,a++}}function p(e){for(var t=32768,a="",r=0;r<e.length;r+=t){var n=Math.min(r+t,e.length);a+=String.fromCharCode.apply(null,e.subarray(r,n))}return btoa(a)}function h(){return"undefined"!=typeof AudioContext?(new AudioContext).sampleRate:44100}function d(e,t){if(!e)throw new Error(t)}function c(e,t,a){return e=+e,t=+t,a=+a,t>e?+t:e>a?+a:+e}function f(e){return e=+e,0>e?0:e>1?1:+e}function S(e,t){var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=t(e[r],r));return a}function g(e,t){var a=Math.random();return void 0!==e&&(a*=e),void 0!==t&&(a+=t),a}function m(e){return e[e.length*Math.random()|0]}function v(e){var t=[];for(var a in e)t.push(a);return t}function P(e){if("undefined"==typeof Float32Array)for(var t=new Array(e),a=0;a<t.length;a++)t[a]=0;return new Float32Array(e)}function y(e){if("undefined"==typeof Uint8Array)for(var t=new Array(e),a=0;a<t.length;a++)t[a]=0;return new Uint8Array(e)}var L=String.fromCharCode,M=2*+Math.PI,A=16,F=1,D=Math.sin,H=Math.pow,b=Math.abs,q=1e-6;e.SampleRate=0,e.Sec=0,e.SetSampleRate=function(t){e.SampleRate=0|t,e.Sec=0|t},e.SetSampleRate(h()),e.Sound=function(t){var a=new r(t,e.DefaultModules),n=P(a.getSamplesLeft());return a.generate(n),s(n)},e.Sounds=function(t,a,r){function n(){if(0==u.length)return void(a&&a(sounds));var i=u.shift();o[i]=e.Sound(t[i]),s++,r&&r(i,s,l),window.setTimeout(n,30)}var o={},i={};i._audio=o;var u=[];S(t,function(e,t){i[t]=function(){"undefined"!=typeof o[t]&&(o[t].currentTime=0,o[t].play())},u.push(t)});var s=0,l=u.length;return n(),i},e.SoundsImmediate=function(t){var a={},r={};return r._audio=a,S(t,function(t,n){a[n]=e.Sound(t),r[n]=function(){"undefined"!=typeof a[n]&&(a[n].currentTime=0,a[n].play())}}),r},"undefined"!=typeof AudioContext?(e.Node=function(t,a,n,o,i){var u=t.createScriptProcessor(o,0,1),s=new r(a,n||e.DefaultModules);return u.onaudioprocess=function(e){var t=e.outputBuffer.getChannelData(0);s.generate(t),!i&&s.finished&&setTimeout(function(){u.disconnect()},30)},u},e.Live=function(t,a,r){r=r||2048;var n={},o=new AudioContext,i=o.createGain();return i.connect(o.destination),n._context=o,n._volume=i,S(t,function(t,u){n[u]=function(){var n=e.Node(o,t,a,r);n.connect(i)}}),n._close=function(){o.close()},n._play=function(t){var n=e.Node(o,t,a,r);n.connect(i)},n}):e.Live=e.Sounds,e.Module={},e.G={};var G=e.stage={PhaseSpeed:0,PhaseSpeedMod:10,Generator:20,SampleMod:30,Volume:40};e.InitDefaultParams=a,e.Processor=r,r.prototype={generate:function(e){for(var t=0;t<e.length;t+=1)e[t]=0;if(!this.finished){for(var $=this.state,a=0|e.length,t=0;t<this.modules.length;t+=1){var r=this.modules[t],n=0|r.process($,e.subarray(0,a));a=Math.min(a,n)}a<e.length&&(this.finished=!0);for(var t=a;t<e.length;t++)e[t]=0}},getSamplesLeft:function(){for(var e=0,t=0;t<this.state.envelopes.length;t+=1)e+=this.state.envelopes[t].N;return 0===e&&(e=3*this.state.SampleRate),e}},e.Module.Frequency={name:"Frequency",params:{Start:{L:30,H:1800,D:440},Min:{L:30,H:1800,D:30},Max:{L:30,H:1800,D:1800},Slide:{L:-1,H:1,D:0},DeltaSlide:{L:-1,H:1,D:0},RepeatSpeed:{L:0,H:3,D:0},ChangeAmount:{L:-12,H:12,D:0},ChangeSpeed:{L:0,H:1,D:0}},stage:G.PhaseSpeed,setup:function($,e){var t=$.SampleRate;$.phaseParams=e,$.phaseSpeed=e.Start*M/t,$.phaseSpeedMax=e.Max*M/t,$.phaseSpeedMin=e.Min*M/t,$.phaseSpeedMin=Math.min($.phaseSpeedMin,$.phaseSpeed),$.phaseSpeedMax=Math.max($.phaseSpeedMax,$.phaseSpeed),$.phaseSlide=1+64*H(e.Slide,3)/t,$.phaseDeltaSlide=H(e.DeltaSlide,3)/(1e3*t),$.repeatTime=0,$.repeatLimit=1/0,e.RepeatSpeed>0&&($.repeatLimit=e.RepeatSpeed*t),$.arpeggiatorTime=0,$.arpeggiatorLimit=e.ChangeSpeed*t,0==e.ChangeAmount&&($.arpeggiatorLimit=1/0),$.arpeggiatorMod=1+e.ChangeAmount/12},process:function($,e){for(var t=+$.phaseSpeed,a=+$.phaseSpeedMin,r=+$.phaseSpeedMax,n=+$.phaseSlide,o=+$.phaseDeltaSlide,i=$.repeatTime,u=$.repeatLimit,s=$.arpeggiatorTime,l=$.arpeggiatorLimit,p=$.arpeggiatorMod,h=0;h<e.length;h++){if(n+=o,t*=n,t=a>t?a:t>r?r:t,i>u)return this.setup($,$.phaseParams),h+this.process($,e.subarray(h))-1;i++,s>l&&(t*=p,s=0,l=1/0),s++,e[h]+=t}return $.repeatTime=i,$.arpeggiatorTime=s,$.arpeggiatorLimit=l,$.phaseSpeed=t,$.phaseSlide=n,e.length}},e.Module.Vibrato={name:"Vibrato",params:{Depth:{L:0,H:1,D:0},DepthSlide:{L:-1,H:1,D:0},Frequency:{L:.01,H:48,D:0},FrequencySlide:{L:-1,H:1,D:0}},stage:G.PhaseSpeedMod,setup:function($,e){var t=$.SampleRate;$.vibratoPhase=0,$.vibratoDepth=e.Depth,$.vibratoPhaseSpeed=e.Frequency*M/t,$.vibratoPhaseSpeedSlide=1+3*H(e.FrequencySlide,3)/t,$.vibratoDepthSlide=e.DepthSlide/t},process:function($,e){var t=+$.vibratoPhase,a=+$.vibratoDepth,r=+$.vibratoPhaseSpeed,n=+$.vibratoPhaseSpeedSlide,o=+$.vibratoDepthSlide;if(0==a&&0>=o)return e.length;for(var i=0;i<e.length;i++)t+=r,t>M&&(t-=M),e[i]+=e[i]*D(t)*a,r*=n,a+=o,a=f(a);return $.vibratoPhase=t,$.vibratoDepth=a,$.vibratoPhaseSpeed=r,e.length}},e.Module.Generator={name:"Generator",params:{Func:{C:e.G,D:"square"},A:{L:0,H:1,D:0},B:{L:0,H:1,D:0},ASlide:{L:-1,H:1,D:0},BSlide:{L:-1,H:1,D:0}},stage:G.Generator,setup:function($,t){$.generatorPhase=0,"string"==typeof t.Func?$.generator=e.G[t.Func]:$.generator=t.Func,"object"==typeof $.generator&&($.generator=$.generator.create()),d("function"==typeof $.generator,"generator must be a function"),$.generatorA=t.A,$.generatorASlide=t.ASlide,$.generatorB=t.B,$.generatorBSlide=t.BSlide},process:function($,e){return $.generator($,e)}};var B=65536;e.Module.Guitar={name:"Guitar",params:{A:{L:0,H:1,D:1},B:{L:0,H:1,D:1},C:{L:0,H:1,D:1}},stage:G.Generator,setup:function($,e){$.guitarA=e.A,$.guitarB=e.B,$.guitarC=e.C,$.guitarBuffer=P(B),$.guitarHead=0;for(var t=$.guitarBuffer,a=0;a<t.length;a++)t[a]=2*Math.random()-1},process:function($,e){for(var t=B,a=t-1,r=+$.guitarA,n=+$.guitarB,o=+$.guitarC,i=r+n+o,u=$.guitarHead,s=$.guitarBuffer,l=0;l<e.length;l++){var p=M/e[l]|0;p=p>t?t:p;var h=u-p+t&a;s[u]=(s[h-0+t&a]*r+s[h-1+t&a]*n+s[h-2+t&a]*o)/i,e[l]=s[u],u=u+1&a}return $.guitarHead=u,e.length}},e.Module.Filter={name:"Filter",params:{LP:{L:0,H:1,D:1},LPSlide:{L:-1,H:1,D:0},LPResonance:{L:0,H:1,D:0},HP:{L:0,H:1,D:0},HPSlide:{L:-1,H:1,D:0}},stage:G.SampleMod+0,setup:function($,e){$.FilterEnabled=e.HP>q||e.LP<1-q,$.LPEnabled=e.LP<1-q,$.LP=H(e.LP,3)/10,$.LPSlide=1+100*e.LPSlide/$.SampleRate,$.LPPos=0,$.LPPosSlide=0,$.LPDamping=5/(1+20*H(e.LPResonance,2))*(.01+e.LP),$.LPDamping=1-Math.min($.LPDamping,.8),$.HP=H(e.HP,2)/10,$.HPPos=0,$.HPSlide=1+100*e.HPSlide/$.SampleRate},enabled:function($){return $.FilterEnabled},process:function($,e){if(!this.enabled($))return e.length;for(var t=+$.LP,a=+$.LPPos,r=+$.LPPosSlide,n=+$.LPSlide,o=+$.LPDamping,i=+$.LPEnabled,u=+$.HP,s=+$.HPPos,l=+$.HPSlide,p=0;p<e.length;p++){(u>q||-q>u)&&(u*=l,u=q>u?q:u>.1?.1:u);var h=a;t*=n,t=0>t?t=0:t>.1?.1:t;var d=e[p];i?(r+=(d-a)*t,r*=o):(a=d,r=0),a+=r,s+=a-h,s*=1-u,e[p]=s}return $.LPPos=a,$.LPPosSlide=r,$.LP=t,$.HP=u,$.HPPos=s,e.length}};var C=1024;e.Module.Phaser={name:"Phaser",params:{Offset:{L:-1,H:1,D:0},Sweep:{L:-1,H:1,D:0}},stage:G.SampleMod+1,setup:function($,e){$.phaserBuffer=P(C),$.phaserPos=0,$.phaserOffset=H(e.Offset,2)*(C-4),$.phaserOffsetSlide=4e3*H(e.Sweep,3)/$.SampleRate},enabled:function($){return b($.phaserOffsetSlide)>q||b($.phaserOffset)>q},process:function($,e){if(!this.enabled($))return e.length;for(var t=C,a=t-1,r=$.phaserBuffer,n=0|$.phaserPos,o=+$.phaserOffset,i=+$.phaserOffsetSlide,u=0;u<e.length;u++){o+=i,0>o&&(o=-o,i=-i),o>a&&(o=a,i=0),r[n]=e[u];var s=n-(0|o)+t&a;e[u]+=r[s],n=n+1&a|0}return $.phaserPos=n,$.phaserOffset=o,e.length}},e.Module.Volume={name:"Volume",params:{Master:{L:0,H:1,D:.5},Attack:{L:.001,H:1,D:.01},Sustain:{L:0,H:2,D:.3},Punch:{L:0,H:3,D:1},Decay:{L:.001,H:2,D:1}},stage:G.Volume,setup:function($,e){var t=$.SampleRate,a=e.Master,r=a*(1+e.Punch);$.envelopes=[{S:0,E:a,N:e.Attack*t|0},{S:r,E:a,N:e.Sustain*t|0},{S:a,E:0,N:e.Decay*t|0}];for(var n=0;n<$.envelopes.length;n+=1){var o=$.envelopes[n];o.G=(o.E-o.S)/o.N}},process:function($,e){for(var t=0;$.envelopes.length>0&&t<e.length;){for(var a=$.envelopes[0],r=a.S,n=a.G,o=0|Math.min(e.length-t,a.N),i=t+o|0;i>t;t+=1)e[t]*=r,r+=n,r=c(r,0,10);a.S=r,a.N-=o,a.N<=0&&$.envelopes.shift()}return t}},e.DefaultModules=[e.Module.Frequency,e.Module.Vibrato,e.Module.Generator,e.Module.Filter,e.Module.Phaser,e.Module.Volume],e.DefaultModules.sort(t),e.EmptyParams=n,e._RemoveEmptyParams=o,e.Preset={Reset:function(){return n()},Coin:function(){var e=n();return e.Frequency.Start=g(880,660),e.Volume.Sustain=g(.1),e.Volume.Decay=g(.4,.1),e.Volume.Punch=g(.3,.3),g()<.5&&(e.Frequency.ChangeSpeed=g(.15,.1),e.Frequency.ChangeAmount=g(8,4)),o(e),e},Laser:function(){var e=n();return e.Generator.Func=m(["square","saw","sine"]),g()<.33?(e.Frequency.Start=g(880,440),e.Frequency.Min=g(.1),e.Frequency.Slide=g(.3,-.8)):(e.Frequency.Start=g(1200,440),e.Frequency.Min=e.Frequency.Start-g(880,440),e.Frequency.Min<110&&(e.Frequency.Min=110),e.Frequency.Slide=g(.3,-1)),g()<.5?(e.Generator.A=g(.5),e.Generator.ASlide=g(.2)):(e.Generator.A=g(.5,.4),e.Generator.ASlide=g(.7)),e.Volume.Sustain=g(.2,.1),e.Volume.Decay=g(.4),g()<.5&&(e.Volume.Punch=g(.3)),g()<.33&&(e.Phaser.Offset=g(.2),e.Phaser.Sweep=g(.2)),g()<.5&&(e.Filter.HP=g(.3)),o(e),e},Explosion:function(){var e=n();return e.Generator.Func="noise",g()<.5?(e.Frequency.Start=g(440,40),e.Frequency.Slide=g(.4,-.1)):(e.Frequency.Start=g(1600,220),e.Frequency.Slide=g(-.2,-.2)),g()<.2&&(e.Frequency.Slide=0),g()<.3&&(e.Frequency.RepeatSpeed=g(.5,.3)),e.Volume.Sustain=g(.3,.1),e.Volume.Decay=g(.5),e.Volume.Punch=g(.6,.2),g()<.5&&(e.Phaser.Offset=g(.9,-.3),e.Phaser.Sweep=g(-.3)),g()<.33&&(e.Frequency.ChangeSpeed=g(.3,.6),e.Frequency.ChangeAmount=g(24,-12)),o(e),e},Powerup:function(){var e=n();return g()<.5?e.Generator.Func="saw":e.Generator.A=g(.6),e.Frequency.Start=g(220,440),g()<.5?(e.Frequency.Slide=g(.5,.2),e.Frequency.RepeatSpeed=g(.4,.4)):(e.Frequency.Slide=g(.2,.05),g()<.5&&(e.Vibrato.Depth=g(.6,.1),e.Vibrato.Frequency=g(30,10))),e.Volume.Sustain=g(.4),e.Volume.Decay=g(.4,.1),o(e),e},Hit:function(){var e=n();return e.Generator.Func=m(["square","saw","noise"]),e.Generator.A=g(.6),e.Generator.ASlide=g(1,-.5),e.Frequency.Start=g(880,220),e.Frequency.Slide=-g(.4,.3),e.Volume.Sustain=g(.1),e.Volume.Decay=g(.2,.1),g()<.5&&(e.Filter.HP=g(.3)),o(e),e},Jump:function(){var e=n();return e.Generator.Func="square",e.Generator.A=g(.6),e.Frequency.Start=g(330,330),e.Frequency.Slide=g(.4,.2),e.Volume.Sustain=g(.3,.1),e.Volume.Decay=g(.2,.1),g()<.5&&(e.Filter.HP=g(.3)),g()<.3&&(e.Filter.LP=g(-.6,1)),o(e),e},Select:function(){var e=n();return e.Generator.Func=m(["square","saw"]),e.Generator.A=g(.6),e.Frequency.Start=g(660,220),e.Volume.Sustain=g(.1,.1),e.Volume.Decay=g(.2),e.Filter.HP=.2,o(e),e},Lucky:function(){var t=n();return S(t,function(t,a){var r=e.Module[a].params;S(r,function(e,a){if(e.C){var r=v(e.C);t[a]=r[r.length*Math.random()|0]}else t[a]=Math.random()*(e.H-e.L)+e.L})}),t.Volume.Master=.4,t.Filter={},o(t),t}},e.G.unoise=i("sample = Math.random();"),e.G.sine=i("sample = Math.sin(phase);"),e.G.saw=i("sample = 2*(phase/TAU - ((phase/TAU + 0.5)|0));"),e.G.triangle=i("sample = Math.abs(4 * ((phase/TAU - 0.25)%1) - 2) - 1;"),e.G.square=i("var s = Math.sin(phase); sample = s > A ? 1.0 : s < A ? -1.0 : A;"),e.G.synth=i("sample = Math.sin(phase) + .5*Math.sin(phase/2) + .3*Math.sin(phase/4);");var w=0;e.G.noise=i("if(phase % TAU < 4){__noiseLast = Math.random() * 2 - 1;} sample = __noiseLast;"),e.G.string={create:function(){for(var e=65536,t=e-1,a=P(e),r=0;r<a.length;r++)a[r]=2*Math.random()-1;var n=0;return function($,r){for(var o=2*Math.PI,i=+$.generatorA,u=+$.generatorASlide,s=+$.generatorB,l=+$.generatorBSlide,p=a,h=0;h<r.length;h++){var d=r[h],c=o/d|0;i+=u,s+=l,i=0>i?0:i>1?1:i,s=0>s?0:s>1?1:s;var f=n-c+e&t,S=(1*p[f-0+e&t]+p[f-1+e&t]*i+p[f-2+e&t]*s)/(1+i+s);p[n]=S,r[h]=p[n],n=n+1&t}return $.generatorA=i,$.generatorB=s,r.length}}},e.CreateWave=u,e.CreateAudio=s,e.DownloadAsFile=function(e){d(e instanceof Audio,"input must be an Audio object"),document.location.href=e.src},e.Util={},e.Util.CopyFToU8=l,e.Util.U8ToB64=p,e._createFloatArray=P}(this.jsfx={});